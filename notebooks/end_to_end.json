{"paragraphs":[{"text":"%md\n## Welcome to SKIL. \n\n### This notebook demonstrates an end-to-end training process within SKIL. You will learn the following:\n- Create a model with Deeplearning4j to classify hand-written digits (MNIST dataset).\n- Create a similar model with Keras, to compare the two.\n- Register both models in your current SKIL experiment.\n- Select the better performing model and deploy it.\n- Use this notebook to get predictions from the deployed model and visualize the results in the browser.\n\nWe'll walk you through step by step. You can just read through the notebook cells and execute the code linearly, following the instructions as you go. \n","dateUpdated":"2018-09-11T09:08:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Welcome to SKIL.</h2>\n<h3>This notebook demonstrates an end-to-end training process within SKIL. You will learn the following:</h3>\n<ul>\n<li>Create a model with Deeplearning4j to classify hand-written digits (MNIST dataset).</li>\n<li>Create a similar model with Keras, to compare the two.</li>\n<li>Register both models in your current SKIL experiment.</li>\n<li>Select the better performing model and deploy it.</li>\n<li>Use this notebook to get predictions from the deployed model and visualize the results in the browser.</li>\n</ul>\n<p>We'll walk you through step by step. You can just read through the notebook cells and execute the code linearly, following the instructions as you go.</p>\n"}]},"apps":[],"jobName":"paragraph_1536656911289_-785644832","id":"20180911-080353_327652166","dateCreated":"2018-09-11T09:08:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:107"},{"text":"%md\n## Import Deeplearning4j dependencies and create a SKIL context.","dateUpdated":"2018-09-11T09:20:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","results":{},"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Import Deeplearning4j dependencies and create a SKIL context.</h2>\n"}]},"apps":[],"jobName":"paragraph_1536656911295_-786414330","id":"20180911-080602_636380219","dateCreated":"2018-09-11T09:08:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108"},{"text":"import org.datavec.api.transform._\nimport org.deeplearning4j.datasets.iterator._\nimport org.deeplearning4j.datasets.iterator.impl._\nimport org.deeplearning4j.eval.Evaluation\nimport org.deeplearning4j.nn.api._\nimport org.deeplearning4j.nn.multilayer._\nimport org.deeplearning4j.nn.graph._\nimport org.deeplearning4j.nn.conf._\nimport org.deeplearning4j.nn.conf.inputs._\nimport org.deeplearning4j.nn.conf.layers._\nimport org.deeplearning4j.nn.conf.layers._\nimport org.deeplearning4j.nn.weights._\nimport org.deeplearning4j.optimize.listeners._\nimport org.deeplearning4j.api.storage.impl.RemoteUIStatsStorageRouter\nimport org.deeplearning4j.ui.stats.StatsListener\nimport org.nd4j.linalg.activations.Activation\nimport org.nd4j.linalg.learning.config._\nimport org.nd4j.linalg.lossfunctions.LossFunctions._\nimport org.nd4j.linalg.factory.Nd4j\nimport io.skymind.zeppelin.utils._\nimport io.skymind.modelproviders.history.client.ModelHistoryClient\nimport io.skymind.modelproviders.history.model._\n\nval skilContext = new SkilContext()\nval client = skilContext.client","dateUpdated":"2018-09-11T09:20:44+0000","config":{"tableHide":true,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.datavec.api.transform._\nimport org.deeplearning4j.datasets.iterator._\nimport org.deeplearning4j.datasets.iterator.impl._\nimport org.deeplearning4j.eval.Evaluation\nimport org.deeplearning4j.nn.api._\nimport org.deeplearning4j.nn.multilayer._\nimport org.deeplearning4j.nn.graph._\nimport org.deeplearning4j.nn.conf._\nimport org.deeplearning4j.nn.conf.inputs._\nimport org.deeplearning4j.nn.conf.layers._\nimport org.deeplearning4j.nn.conf.layers._\nimport org.deeplearning4j.nn.weights._\nimport org.deeplearning4j.optimize.listeners._\nimport org.deeplearning4j.api.storage.impl.RemoteUIStatsStorageRouter\nimport org.deeplearning4j.ui.stats.StatsListener\nimport org.nd4j.linalg.activations.Activation\nimport org.nd4j.linalg.learning.config._\nimport org.nd4j.linalg.lossfunctions.LossFunctions._\nimport org.nd4j.linalg.factory.Nd4j\nimport io.skymind.zeppelin.utils._\nimport io.skymind.modelproviders.history.client.ModelHistoryClient\nimport io.skymind.modelproviders.history.model._\nskilContext: io.skymind.zeppelin.utils.SkilContext = io.skymind.zeppelin.utils.SkilContext@7acbdd1\nclient: io.skymind.modelproviders.history.client.ModelHistoryClient = io.skymind.modelproviders.history.client.ModelHistoryClient@308be294\n"}]},"apps":[],"jobName":"paragraph_1536656911296_-800650039","id":"20180911-081132_759063969","dateCreated":"2018-09-11T09:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109","user":"admin","dateFinished":"2018-09-11T09:15:46+0000","dateStarted":"2018-09-11T09:15:26+0000"},{"text":"%md\n## Create DL4J model and train it on hand-written digit data","dateUpdated":"2018-09-11T09:20:51+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","results":{},"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Create DL4J model and train it on hand-written digit data</h2>\n"}]},"apps":[],"jobName":"paragraph_1536656911296_-800650039","id":"20180911-081324_2140484897","dateCreated":"2018-09-11T09:08:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:110"},{"text":"val numRows = 28\nval numColumns = 28 // Data consists of 28x28 pixel images\nval outputNum = 10 // number of output classes\nval batchSize = 128 // batch size for each epoch\nval rngSeed = 42 // random number seed for reproducibility\nval numEpochs = 5 // number of epochs to perform\n\n// Load training and test data\nval trainData = new MnistDataSetIterator(batchSize, true, rngSeed)\nval testData = new MnistDataSetIterator(batchSize, false, rngSeed)\n\n// Define simple two-layer neural network\nval model = {\n    \n    // Define a model configuration first.\n    val conf = new NeuralNetConfiguration.Builder()\n        .seed(rngSeed) // include a random seed for reproducibility\n        .updater(new AMSGrad(0.5)) //specify the updating method and learning rate.\n        .l2(5e-4).list()\n        .layer(new DenseLayer.Builder().nIn(numRows * numColumns)\n                .nOut(768).activation(Activation.RELU)\n                .weightInit(WeightInit.RELU).dropOut(1 - 0.2).build())\n        .layer(new OutputLayer.Builder(LossFunction.MCXENT)\n                .nIn(768).nOut(outputNum).activation(Activation.SOFTMAX)\n                .weightInit(WeightInit.XAVIER).build())\n        .build()\n    \n    // Create a model from the configuration, initialize and summarize it.\n    val model = new MultiLayerNetwork(conf)\n    model.init()\n    println(model.summary())\n    model\n}\n\n// Let Zeppelin listen to training process and fit model on training data.\nmodel.setListeners(new ZeppelinTrainingListener(z, testData, numEpochs))\nmodel.fit(trainData, numEpochs)\n\n// Evaluate model, this will print some evaluation metrics and the confusion matrix for this classification.\nvar evaluation: Evaluation = null\nevaluation = model.evaluate(testData)\nprintln(evaluation)\n\n","dateUpdated":"2018-09-11T09:16:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"numRows: Int = 28\nnumColumns: Int = 28\noutputNum: Int = 10\nbatchSize: Int = 128\nrngSeed: Int = 42\nnumEpochs: Int = 5\ntrainData: org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator = org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator@4c0f04a3\ntestData: org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator = org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator@2d2ff579\n\n==========================================================================================================================================================================================================================================================\nLayerName (LayerType)                   nIn,nOut  TotalParams ParamsShape                             \n==========================================================================================================================================================================================================================================================\nlayer0 (DenseLayer)                     784,768     602880    W:{784,768}, b:{1,768}                  \nlayer1 (OutputLayer)                    768,10      7690      W:{768,10}, b:{1,10}                    \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n            Total Parameters:  610570\n        Trainable Parameters:  610570\n           Frozen Parameters:  0\n==========================================================================================================================================================================================================================================================\n\nmodel: org.deeplearning4j.nn.multilayer.MultiLayerNetwork = org.deeplearning4j.nn.multilayer.MultiLayerNetwork@73388ef9\nEpoch 1/5\n- 6s - score: 0.07337559119288857 - validation accuracy: 0.9641\nEpoch 2/5\n- 6s - score: 0.09032938435173839 - validation accuracy: 0.974\nEpoch 3/5\n- 7s - score: 0.09711224355798555 - validation accuracy: 0.9814\nEpoch 4/5\n- 7s - score: 0.17749881715821259 - validation accuracy: 0.9785\nEpoch 5/5\n- 7s - score: 0.12240368544506207 - validation accuracy: 0.9815\nevaluation: org.deeplearning4j.eval.Evaluation = null\nevaluation: org.deeplearning4j.eval.Evaluation = \n\n========================Evaluation Metrics========================\n # of classes:    10\n Accuracy:        0.9815\n Precision:       0.9815\n Recall:          0.9815\n F1 Score:        0.9814\nPrecision, recall & F1: macro-averaged (equally weighted avg. of 10 classes)\n\n\n=========================Confusion Matrix=========================\n    0    1    2    3    4    5    6    7    8    9\n---------------------------------------------------\n  966    1    1    0    1    0    4    1    3    3 | 0 = 0\n    0 1130    3    0    0    0    1    0    1    0 | 1 = 1\n    1    0 1010    3    2    1    2    5    8    0 | 2 = 2\n    1    0    3  979    0   17    0    3    3    4 | 3 = 3\n    0    2    2    0  952    0    3    0    0   23 | 4 = 4\n    2    0    ...\n\n========================Evaluation Metrics========================\n # of classes:    10\n Accuracy:        0.9815\n Precision:       0.9815\n Recall:          0.9815\n F1 Score:        0.9814\nPrecision, recall & F1: macro-averaged (equally weighted avg. of 10 classes)\n\n\n=========================Confusion Matrix=========================\n    0    1    2    3    4    5    6    7    8    9\n---------------------------------------------------\n  966    1    1    0    1    0    4    1    3    3 | 0 = 0\n    0 1130    3    0    0    0    1    0    1    0 | 1 = 1\n    1    0 1010    3    2    1    2    5    8    0 | 2 = 2\n    1    0    3  979    0   17    0    3    3    4 | 3 = 3\n    0    2    2    0  952    0    3    0    0   23 | 4 = 4\n    2    0    0    1    0  880    4    1    2    2 | 5 = 5\n    1    2    0    0    1    2  950    0    2    0 | 6 = 6\n    1    6    9    3    0    0    0  994    2   13 | 7 = 7\n    2    0    2    0    1    0    0    1  962    6 | 8 = 8\n    0    3    0    2    4    6    0    2    0  992 | 9 = 9\n\nConfusion matrix format: Actual (rowClass) predicted as (columnClass) N times\n==================================================================\n"}]},"apps":[],"jobName":"paragraph_1536656911296_-800650039","id":"20180911-081517_332436512","dateCreated":"2018-09-11T09:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111","user":"admin","dateFinished":"2018-09-11T09:16:53+0000","dateStarted":"2018-09-11T09:16:00+0000"},{"text":"// Register model in SKIL, using the skilContext created earlier\n\nval modelId = skilContext.addModelToExperiment(z, model, \"sample-mnist-model\")\nval evalId = skilContext.addEvaluationToModel(z, modelId, evaluation, \"mlp \" + numEpochs + \" epochs\")","dateUpdated":"2018-09-11T09:21:01+0000","config":{"tableHide":true,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"modelId: String = af0842e9-a0d8-44fd-b496-3d506518c9d1\nevalId: String = 01064a96-7d4b-4f63-a4f3-e4ebf413ad2f\n"}]},"apps":[],"jobName":"paragraph_1536656911296_-800650039","id":"20180911-082019_351937371","dateCreated":"2018-09-11T09:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:112","user":"admin","dateFinished":"2018-09-11T09:17:13+0000","dateStarted":"2018-09-11T09:17:11+0000"},{"text":"%md\n\n# Create a Keras model and train it on the same data","dateUpdated":"2018-09-11T09:08:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Create a Keras model and train it on the same data</h1>\n"}]},"apps":[],"jobName":"paragraph_1536656911297_-801034788","id":"20180911-082344_510844853","dateCreated":"2018-09-11T09:08:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:113"},{"text":"%pyspark\n\n# You can mix programming languages from cell to cell. We're using Python now, instead of Scala\nimport skil\nskilContext = skil.SkilContext(sc) # For Python we need a Python SkilContext\n\nimport numpy as np\nimport tensorflow as tf\n\nimport keras\nfrom keras.datasets import mnist\nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout\nfrom keras.regularizers import l2\nfrom keras.optimizers import Adam\n\n# The model hyperparameters are the same as for the DL4J model earlier.\nbatch_size = 256\nnum_output = 10\nepochs = 5\nrng_seed = 42\n\n# We fix the random seed for reproducibility\nnp.random.seed(42)\ntf.set_random_seed(42)\n\n# Load and reshape MNIST data\n(x_train, y_train), (x_test, y_test) = mnist.load_data()\nx_train = x_train.reshape(60000, 784)\nx_test = x_test.reshape(10000, 784)\nx_train = x_train.astype('float32')\nx_test = x_test.astype('float32')\nx_train /= 255\nx_test /= 255\ny_train = keras.utils.to_categorical(y_train, num_output)\ny_test = keras.utils.to_categorical(y_test, num_output)\n\n# In Keras you add layers to a Sequential model and compile it.\nmodel = Sequential()\nmodel.add(Dense(768, activation='relu', input_shape=(784,)))\nmodel.add(Dropout(0.2))\nmodel.add(Dense(num_output, activation='softmax'))\n\nmodel.compile(loss='categorical_crossentropy',\n  optimizer=Adam(lr=0.004, amsgrad=True),\n  metrics=['accuracy'])\n\n# Fit the model on data\nmodel.fit(x_train, y_train,\n    batch_size=batch_size,\n    epochs=epochs,\n    verbose=2,\n    validation_data=(x_test, y_test))\n\n# Print the model summary and evaluate the model\nprint(model.summary())\nscore = model.evaluate(x_test, y_test, verbose=0)\nprint('Test loss:', score[0])\nprint('Test accuracy:', score[1])\n\n# As last step, you also register the Keras model in this SKIL experiment\nmodel_id = skilContext.addModelToExperiment(z, model, \"keras-mnist-model\")\nskilContext.addEvaluationToModel(z, model_id, model, x_test, y_test, \"Keras mlp \" + str(epochs) + \" epochs\")\n","dateUpdated":"2018-09-11T09:08:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Train on 60000 samples, validate on 10000 samples\nEpoch 1/5\n - 5s - loss: 0.2276 - acc: 0.9300 - val_loss: 0.1112 - val_acc: 0.9644\nEpoch 2/5\n - 5s - loss: 0.0958 - acc: 0.9700 - val_loss: 0.0876 - val_acc: 0.9722\nEpoch 3/5\n - 5s - loss: 0.0688 - acc: 0.9784 - val_loss: 0.0882 - val_acc: 0.9738\nEpoch 4/5\n - 5s - loss: 0.0515 - acc: 0.9837 - val_loss: 0.0755 - val_acc: 0.9775\nEpoch 5/5\n - 5s - loss: 0.0429 - acc: 0.9859 - val_loss: 0.0746 - val_acc: 0.9785\n_________________________________________________________________\nLayer (type)                 Output Shape              Param #   \n=================================================================\ndense_7 (Dense)              (None, 768)               602880    \n_________________________________________________________________\ndropout_4 (Dropout)          (None, 768)               0         \n_________________________________________________________________\ndense_8 (Dense)              (None, 10)                7690      \n=================================================================\nTotal params: 610,570\nTrainable params: 610,570\nNon-trainable params: 0\n_________________________________________________________________\nNone\n('Test loss:', 0.0745941275401041)\n('Test accuracy:', 0.9785)\nu'4f1d5e50-1c0f-4d17-97b1-82ef375adfb6'\n"}]},"apps":[],"jobName":"paragraph_1536656911297_-801034788","id":"20180911-082444_508775148","dateCreated":"2018-09-11T09:08:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:114"},{"text":"%md\n\n## Model deployment\n\nWith the random seeds we chose, you see that the DL4J performs slightly better than the Keras model, for different seeds the situation might be reversed. The important part is that we achieve good accuracy with both here.\n\nTo continue with this example, you need to go back to the overview of this experiment (in the workspace you're currently in). You do this to deploy the DL4J model with a SKIL model server.\n- In the overview of this experiment you will see the two models we just registered. Select \"sample-mnist-model\" and click \"Deploy\"\n- You will then by guided through the deployment process. Create a new deployment called \"demo\" and confirm deployment by clicking \"Deploy\"\n- In the \"deployments\" tab check that your \"demo\" deployment is available. Click on the deployment and \"Start\" it, then wait until its status is \"Fully deployed\".\n\nAfter that you can come back to this notebook and follow the next steps.\n","dateUpdated":"2018-09-11T09:24:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Model deployment</h2>\n<p>With the random seeds we chose, you see that the DL4J performs slightly better than the Keras model, for different seeds the situation might be reversed. The important part is that we achieve good accuracy with both here.</p>\n<p>To continue with this example, you need to go back to the overview of this experiment (in the workspace you're currently in). You do this to deploy the DL4J model with a SKIL model server.</p>\n<ul>\n<li>In the overview of this experiment you will see the two models we just registered. Select &ldquo;sample-mnist-model&rdquo; and click &ldquo;Deploy&rdquo;</li>\n<li>You will then by guided through the deployment process. Create a new deployment called &ldquo;demo&rdquo; and confirm deployment by clicking &ldquo;Deploy&rdquo;</li>\n<li>In the &ldquo;deployments&rdquo; tab check that your &ldquo;demo&rdquo; deployment is available. Click on the deployment and &ldquo;Start&rdquo; it, then wait until its status is &ldquo;Fully deployed&rdquo;.</li>\n</ul>\n<p>After that you can come back to this notebook and follow the next steps.</p>\n"}]},"apps":[],"jobName":"paragraph_1536656911297_-801034788","id":"20180911-082955_1028668042","dateCreated":"2018-09-11T09:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:115","user":"admin","dateFinished":"2018-09-11T09:24:21+0000","dateStarted":"2018-09-11T09:24:21+0000"},{"text":"import io.skymind.skil.predict.client._\nimport io.skymind.skil.service.model._\nimport io.skymind.zeppelin.utils._\nimport io.skymind.modelproviders.history.client.ModelHistoryClient\nimport io.skymind.modelproviders.history.model._\nimport java.awt.image.BufferedImage\n\nval deployment = \"demo\" // make sure this matches the name of your deploymend\nval model = \"samplemnistmodel\" // this should match the name of your deployed model\n\n// Register Prediction service client to get predictions from your deployed model\nval client = skilContext.client\nval predictService = new PredictServiceClient(\"http://localhost:9008/endpoints/\" + deployment + \"/model/\" + model + \"/default\")\npredictService.setAuthToken(client.getAuthToken())","dateUpdated":"2018-09-11T09:21:35+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":true},"editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1536656911297_-801034788","id":"20180911-090019_1528651016","dateCreated":"2018-09-11T09:08:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:116","user":"admin","dateFinished":"2018-09-11T09:18:41+0000","dateStarted":"2018-09-11T09:18:38+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import io.skymind.skil.predict.client._\nimport io.skymind.skil.service.model._\nimport io.skymind.zeppelin.utils._\nimport io.skymind.modelproviders.history.client.ModelHistoryClient\nimport io.skymind.modelproviders.history.model._\nimport java.awt.image.BufferedImage\ndeployment: String = demo\nmodel: String = samplemnistmodel\nclient: io.skymind.modelproviders.history.client.ModelHistoryClient = io.skymind.modelproviders.history.client.ModelHistoryClient@308be294\npredictService: io.skymind.skil.predict.client.PredictServiceClient = io.skymind.skil.predict.client.PredictServiceClient@71ee7a59\n"}]}},{"text":"// Load test data that you can use to experiment with your deployed model\nval testData = new MnistDataSetIterator(16, false, 42)\nval dataSet = testData.next()\n\n\n// This snippet will create a little HTML table that compares input data\n// with prediction results.\nvar outStr = \"\"\"%html <table><tr><th>image</th><th>prediction</th></tr>\"\"\"\nfor (z <- 0 until 16) {\n    val example = dataSet.getFeatures.getRow(z)\n    val bi = new BufferedImage(28, 28, BufferedImage.TYPE_BYTE_GRAY)\n\n    for (i <- 0 until (28 * 28)) {\n        bi.getRaster().setSample(i % 28, i / 28, 0, (255 * example.getDouble(i)).toInt)\n    }\n    \n    outStr += \"<tr><td>\"\n    outStr += skilContext.renderBufferedImage(bi)\n    outStr += \"</td><td>\"\n    outStr += predictService.classify(new Prediction(example, \"example1\")).getResults()(0)\n    outStr += \"</td></tr>\"\n}\noutStr += \"</table>\"\n\nprintln(outStr)","user":"admin","dateUpdated":"2018-09-11T09:23:43+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":true},"editorMode":"ace/mode/scala","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1536657097855_-312344033","id":"20180911-091137_1840953452","dateCreated":"2018-09-11T09:11:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:923","dateFinished":"2018-09-11T09:20:11+0000","dateStarted":"2018-09-11T09:20:06+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"testData: org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator = org.deeplearning4j.datasets.iterator.impl.MnistDataSetIterator@588d98f9\ndataSet: org.nd4j.linalg.dataset.DataSet = \n===========INPUT===================\n[[         0,         0,         0  ...         0         0,         0], \n [         0,         0,         0  ...         0         0,         0], \n [         0,         0,         0  ...         0         0,         0], \n  ..., \n [         0,         0,         0  ...         0         0,         0], \n [         0,         0,         0  ...         0         0,         0], \n [         0,         0,         0  ...         0         0,         0]]\n=================OUTPUT==================\n[[         0,         0,         0,         0,         0,         0,    1.0000,         0,         0,         0], \n [         0,         0,    1.0000,         0,         0,         0,         0,         0,         0,        ...outStr: String = %html <table><tr><th>image</th><th>prediction</th></tr>\n"},{"type":"HTML","data":"<table><tr><th>image</th><th>prediction</th></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAZElEQVR42tXQQRKAMAgDQJ6Wp/GzPC221dGqwKHjxVx3SqBmX4WqLEeowPaQKw+7ITPmZpW55CuFpuKK3rhPRZtPhCc2GUGwKg+77YbRCJ3BYyo9tqsrslnpyd/qdcbc7A77aTZbHX+JUnHttgAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>6</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA2UlEQVR42mNgGFCgG7313/+T0RaYMkyCajf+gsFDSwzJMKDwi0nrQLLvrdHkYt7+fdyjx8Bvkffp798uNMl/XxtlIaw1mJJn90EZgnswJeEg+C9uSc2Xf/8+48UhB/JOAw6NFX///spmwiqltObb319NOPQVAc3MxiEX+/nv33ds2OX4t/39e98Uh0YboKELgDGgpaW17iwQJCNLHv37dwsPQ0P7XxhAkov79vfvm3v3/kAkTh0+HIkkmQ3X8S4rKwstkCCS5zev5efDdI/azbWPF0UqMww0AABzt4aeaTGj3QAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>2</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA2klEQVR42mNgGIag6vfezjwhIFAI6uzsFEKW4m79/A8ZtCNLJv5DBRZIcl7vgALXtm+f7AgErf/+PeJFklwDlJshCmFLvvv3UBdJTuErUFISygn4968KSY7z+L9/f9QYIRy3X//uSCNJyv3792MazNnH/v1yQHZq579/S2DsPf/+7Ubxf9bhVSJQpvjbf6+kcQSTxPF/19NwhuH/fzW45KTv/TvDh0OOaQvCt+iAufr/v51cOCT1//07w4/L0NX//sXgck0qMHyTcEnWASU34pJ0+7fZlIf4ZAUAtKB2RDogDm8AAAAASUVORK5CYII=\" style=\"float: left; display: block; margin: 10px\"></td><td>7</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAwUlEQVR42mNgGKJArOjN/79/50hik5O9+ufP3z9//mzDpg8o97q+7uWfP2aYkt1//mznY2Cw/PNnA4Zc5N8/xw1BBvz5cxlDMvvfX1EQHfL37xUMyZ1//4Alz2HTOe/vH1kGBpaO33/+zMOQzPr751KyA9BVf/5kYUgKVYHE/2KXZBDKOvf377PmT3//Yg0+Nnt7aYYXf/7gDF+OV39m45QM/fNnMpmSf//illyCT+e+P3+M8Elq4ZR0/vJIghpJDgAfmWeza1LycwAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>9</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAlElEQVR42mNgGH6AV11eTl3db/Ka5c2YkkH/Pr77BwavJTEkA37++vfz58/Jy/990sVisEg6J5Cs+/cYp9WCL/8V4JRc9e8CG07J9//m4PbR+1eWOOVi//bi1njyXzhOOZ3PeCTN/z3E7dbAf7W4rVz8TwWnHNPafwI4JXX/P+fBKVn3bxFuK+t+GOKRPMFApiQ6AAD7WznYcwB5kQAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>7</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA2UlEQVR42mNgoAPoe5HDjEtO+sO/fwK4JLf9+/eXH4cc57l///pxaQz59++fGTYJZh0GttP//p1jw6GRG6hxMy5T4//9+2mLQ45t/b9/XSzpj1+9uheHIRkENHVO/z8QeC6DTRIEDr799y8YXbITIreSLfPfv+locuYv//278OvfCjaGGkzJGf/+vVFNauVmcHz47589puQhsNXXgCaIYEomMjDwTf/1/98bKQZMyV4GY2C8/LuuzYBF8t+vP0BioQRmAOW/hXhlsxS24LP//O/fj2o1ZoZBDACgZ4Def9PTTgAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>6</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAsklEQVR42mNgGJpANGbhnpwYViwyqn17//wDgSYskmc/P1vT5qhW9/2pOKbkijAIvemfAU57ee7jkXT491IKp+T2f9045bjv/IvBKdn57yoHnMOGKif9458vnBN0BkWO7/q/5VDlGkGnvqchyzH3/XsqycDAyiWdd+rXv+2xKBqn/vtX4Jmx8hwwDF9ty0K1MOTff3Dg3r9Rry2I7tKYf//+/vo0054bmzcUo6NtGIY0AAB1XUoYQ4s/qwAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>2</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA9klEQVR42mNgGFDAZb3z34FWa1YsUmxlL//+/fvv799UdkzJDqDU3zdAyb+TMeQsnv29lhqiMwWo/aUDuuTK96l8INr05N+/x3jQJDX0oAzOvX//BqNrjT6nDmE0/v17FE1r5Oe/cRCW3KO/f1VQ5ATO/f27Asre9vfvRBTJeKAXTBGSc5DlJP/9+/cb5qTt//7NRZEEatwCZcvcR9eJJFn7F00S5LmnChD2KqBkK4qD3IEivrBw/PtSGkVS6ilQqALIMHuOoREcLn9fz+o/D4o3mAVwwD4RFGWg+Pz7zAwzsidDJV/kYUkKLHlvgJI7ijkHNrECACBxklgYzoquAAAAAElFTkSuQmCC\" style=\"float: left; display: block; margin: 10px\"></td><td>0</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAaklEQVR42mNgGHAQ9E4It+SUv364JSPxSc75pIJb8vlLPA76/wq3XPA/PDqT8EtuwS259p8tTjnJ5x/lcErq/z2M29QO/JJb8Ekm4ZZ8/U8Np5zzr6+4Neb+3Ylbcv3ft7gl3Q8mDHxCBQADyCeLi6d2XAAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>1</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA8ElEQVR42mNgGMRAuu3S37//NkRgkWKLfvMHCP7+uVeIKVn05w9E8s97P3Q5zvd//vx+NqWy/dufP79M0CRrgLomghgbgIwd4aiS1UAxURCj+DiQ9agERdLkx58/UiAGxyyQ1U8VUGTv//kzDUjp7gW766EUimTynz8/PWN2/wXLXTJDtZS54c+fl19AXvnzxEIQ3TOSF/4Cwf+/HxapY4YC/2ZwIJxzwhJ8drchIeSLRQ4UQjglQSH0q+nSn7+1WCQvAiVdBS5h1Wn7Eyj58jV2Y82/Qqz881IOi7HroZJZ2NII7+Q/f7739enRITkCAIxDq0kQv6u5AAAAAElFTkSuQmCC\" style=\"float: left; display: block; margin: 10px\"></td><td>8</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA90lEQVR42mNgGAQgZM6/nbwcWKWY4q/8BYKlzNgkF/+FAEsmTLnuf1DJk7IYcktvwCT/eqNJSW788Rco+X7LG0xJm3tAsX9/69Tl7mFIyp0FmfZFhY8BJHlSHFlO9MgPkCRIDCzJhiy5BOwMMRBz3e+/f6cyIvk96x8QfAGbZQ5kneZBduh5oLavCiAmSwWQiSzJlAEyczpYzgXE7EZ26SmgwA11EFMFZMY15PDxAQq81wMyrJ3vA5lv4hkwJG08636Dgu9NA0oAlILsufkFHEJ/j8xFDfRYWHADJd/noQU572yY5M8JThhxxR7eshAYLC2C3AOeTAEv171qyzWuyAAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>0</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAABHklEQVR42mNgGLLAvqApS56BQVqfVRpVQoTBfP+vv3//fX79+tP3t592IUkpuc6/+e/v3183bt64sePGEyBrJ1zO/effv39vfP37BMIVXQ/kwiWBms57SDlPtQXznE4B5e7AJf/ni8PZOSv//f/3OQNh5bbvqyEMjTOvQa46ZYPkHtWdPzqBFFvx539/X93YkSqA4hGe4J/HjZkm/f17OE4a0/8SJ//+W/bs798nOthCh73m/79//1Yq4gg8oH/+xuCQ4/t3ZcPfDws4sclxHPznymF7718CNknjv094GBi2/rvFi8W1r/7VMHBPAwaOCqak6t+/7AxngYEzjRmb5B77yz/+PnYVwOaepX///X07RwC7T3gWLc7nplqCAwCL6IvI6175RQAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>8</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAZUlEQVR42s2RwQ2AUAxC/2iMxmYdDevX6AV6NHJ9KYGy1jeCEBklDkyJVbMa7iZGpJzKSQfP07RZsG2GHRe2Bba1M7/bb5ogOED/3W5ZfKK5v4oE7TB65dtcsouiQs87KotYv9UBxApx2URCdG4AAAAASUVORK5CYII=\" style=\"float: left; display: block; margin: 10px\"></td><td>6</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA4klEQVR42mNgoD1Qqa2tTcMh1/nz79+/f55oYZPr+v0XDJ5qY5GM//t3zVqQ7KepmJKckpJsbCb3gbIftXFYLNYKlJ2Ly8kaQMkPuCTZu/BIMij+/bsWp2Qrmk6Z0r179/prgtlyz/7+LEOWnAD2/fPtU035Vaf9/fsKWS7/z18YOPYMSFxClvz/9+/ba9eufYMqmKKMJrlIUVHxGlSyCMV96/6igM+TeJAkjT/AxN+/eguiDgdwIcku//D179+fp/NkGETyToGkG1GM1i0tDYSwYoDx+mszriDyra62ZBiUAABKI6RwF1GmMwAAAABJRU5ErkJggg==\" style=\"float: left; display: block; margin: 10px\"></td><td>2</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA5klEQVR42mNgGMyAx71t4j8QuBDEiCbF6f7577+/UMCNKse9HCiGQ5JnKUjsz9nGkJDyL+iSUSC5w64gpukHNEm+U3//PmxgBjGFtqEbOxkoMAfCtAUyb3IgS64EiuRDmDl//95QQJZT+gaUVAEzRa/AzYACVZBzjlaxAZlL/qJLMiwFh8y/A63TQdRcVEnRzh9/EYEwBz1gvQ79gEl+bMMMd88tYMlPqyww5YyWfgdJ7jXHkOHzzPkEsvPbYhE0Gd1Z565DXHIpHkNbKzSeLmsKMuCQvJnMhy15+Pz9+6xFg4NeqREAqoSzvnyuM8QAAAAASUVORK5CYII=\" style=\"float: left; display: block; margin: 10px\"></td><td>9</td></tr><tr><td><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAAxklEQVR42mNgGMSAmRPB5uLl5UWWY+28pw5hCUravPz79y+yZO3fv3fFgDRLwT2gzN83b5AlV/39e4QHaHg9SOrtWXMdNMkVQCrl79/m3Qcb0NwDlHwpzcCwZ/d+EVkMxwIl/6owMIizCmHxiRNQMgiXN1n3/P17jAuXbC0+rdZ//v2fiDP8tv39OwGnpCc+Scl72CWZbU0YGIRuYpfs/vv10KHLOIyd8xcM7qpjte4KWDIfh2MW/P27So8Fh1OZuLmZ6ZMcAX9yX9jtoIJ2AAAAAElFTkSuQmCC\" style=\"float: left; display: block; margin: 10px\"></td><td>5</td></tr></table>\n"}]}},{"text":"\n","user":"admin","dateUpdated":"2018-09-11T09:14:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1536657149082_2017588037","id":"20180911-091229_801908387","dateCreated":"2018-09-11T09:12:29+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1021"}],"name":"end_to_end","id":"2DSVH2N2E","angularObjects":{"2DSJKA36H:existing_process":[],"2DSHNEP6F:existing_process":[],"2DQVGUNQB:existing_process":[],"2DR56ES6N:existing_process":[],"2DRVW5E28:existing_process":[],"2DQCZMYFJ:existing_process":[],"2DSNRGH4Y:existing_process":[],"2DT1R6NYS:existing_process":[],"2DR92E7YC:existing_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}